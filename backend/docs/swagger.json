{
    "swagger": "2.0",
    "info": {
        "description": "This is the backend API for jetswitch project, handling with most of backend logic and communicate with ML Microservice",
        "title": "Go Backend API",
        "contact": {}
    },
    "host": "localhost:8080",
    "basePath": "/",
    "paths": {
        "/api/auth/google": {
            "get": {
                "description": "Redirects the client to the Google consent screen to begin OAuth process.",
                "tags": [
                    "Auth"
                ],
                "summary": "Initiate Google OAuth",
                "responses": {
                    "302": {
                        "description": "Redirects to Google",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/api/auth/google/callback": {
            "get": {
                "description": "Handles the redirect from Google, exchanges the code for a token, and finds/creates the user. Redirects to the frontend with a JWT.",
                "tags": [
                    "Auth"
                ],
                "summary": "Google OAuth Callback",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Authorization code from Google",
                        "name": "code",
                        "in": "query",
                        "required": true
                    }
                ],
                "responses": {
                    "302": {
                        "description": "Redirects to frontend with token in URL (either /auth/callback or /select-user-type)",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "400": {
                        "description": "No authorization code provided.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to exchange token or process user info.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/auth/login": {
            "post": {
                "description": "Authenticates a user with username and password and returns a JWT token.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Log in a local user",
                "parameters": [
                    {
                        "description": "User login credentials",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.LoginRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Login successful.",
                        "schema": {
                            "$ref": "#/definitions/models.AuthResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid username/password or account uses Google sign-in.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/auth/me": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Retrieves the authenticated user's details based on the provided JWT.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Get Current User Info",
                "responses": {
                    "200": {
                        "description": "Current authenticated user details.",
                        "schema": {
                            "type": "object"
                        }
                    },
                    "401": {
                        "description": "Missing or invalid JWT token.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "User not found in database.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/auth/register": {
            "post": {
                "description": "Creates a new account, hashes the password, and returns a JWT token.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Register a new local user",
                "parameters": [
                    {
                        "description": "User registration details",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.RegisterRequest"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "User successfully registered and logged in.",
                        "schema": {
                            "$ref": "#/definitions/models.AuthResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid inputs, or username/email already exists.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error (e.g., failed to hash password or generate token).",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/auth/update-user-type": {
            "post": {
                "description": "Updates the user's role (listener/artist). Intended for use after OAuth registration.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Update user type",
                "parameters": [
                    {
                        "description": "User ID and new type ('listener' or 'artist')",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "type": "object"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User type updated successfully.",
                        "schema": {
                            "$ref": "#/definitions/models.MessageResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body or user type.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Database error during update.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/music/analyze": {
            "post": {
                "description": "Sends a song URL and metadata to the ML service to extract features, store the song, and retrieve a list of similar tracks.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Music"
                ],
                "summary": "Analyze a new track and find similar songs",
                "parameters": [
                    {
                        "description": "Song URL and metadata",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.AnalyzeMusicRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Returns the processed song and a list of similar songs.",
                        "schema": {
                            "$ref": "#/definitions/models.AnalyzeMusicResponse"
                        }
                    },
                    "400": {
                        "description": "Required fields are missing or invalid request body.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to communicate with ML service or an internal error occurred during analysis.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/music/feedback": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Stores a user's explicit vote (up/down) on a suggested song match.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Music",
                    "Feedback"
                ],
                "summary": "Store song recommendation feedback",
                "parameters": [
                    {
                        "description": "Feedback details (query_song_id, suggested_song_id, vote: 1 or -1)",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.FeedbackRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Feedback received.",
                        "schema": {
                            "$ref": "#/definitions/models.MessageResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body or invalid vote value.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Missing or invalid JWT token.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to communicate with ML service or an internal error occurred.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/music/similar": {
            "get": {
                "description": "Finds songs in the database similar to a specified track ID.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Music"
                ],
                "summary": "Find similar songs by ID",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "The ID of the song to search for similarities",
                        "name": "id",
                        "in": "query",
                        "required": true
                    },
                    {
                        "type": "integer",
                        "description": "Maximum number of similar songs to return (default: 10)",
                        "name": "limit",
                        "in": "query"
                    },
                    {
                        "type": "boolean",
                        "description": "Exclude the query song from results (default: true)",
                        "name": "exclude_self",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "A list of similar songs.",
                        "schema": {
                            "$ref": "#/definitions/models.GetSimilarSongsResponse"
                        }
                    },
                    "400": {
                        "description": "Song ID parameter is missing.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to communicate with ML service or an internal error occurred.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/music/songs": {
            "get": {
                "description": "Retrieves all song metadata stored in the database.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Music"
                ],
                "summary": "List all stored songs",
                "responses": {
                    "200": {
                        "description": "A list of all songs.",
                        "schema": {
                            "$ref": "#/definitions/models.ListAllSongsResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to communicate with ML service or an internal error occurred.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/music/songs/{id}": {
            "get": {
                "description": "Retrieves metadata for a single song by its ID.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Music"
                ],
                "summary": "Get a song by ID",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Song ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "The requested song metadata.",
                        "schema": {
                            "$ref": "#/definitions/models.GetSongByIDResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid song ID format.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Song not found.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to communicate with ML service or an internal error occurred.",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "models.AnalyzeMusicRequest": {
            "type": "object",
            "properties": {
                "added_by": {
                    "type": "integer"
                },
                "artist_name": {
                    "type": "string"
                },
                "release_date": {
                    "type": "string"
                },
                "source_platform": {
                    "type": "string"
                },
                "title": {
                    "type": "string"
                },
                "url": {
                    "type": "string"
                }
            }
        },
        "models.AnalyzeMusicResponse": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                },
                "similar_songs": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/models.SimilarSong"
                    }
                },
                "song": {
                    "$ref": "#/definitions/models.SongResult"
                }
            }
        },
        "models.AuthResponse": {
            "type": "object",
            "properties": {
                "is_new_user": {
                    "description": "For Google OAuth flow",
                    "type": "boolean"
                },
                "message": {
                    "type": "string"
                },
                "token": {
                    "type": "string"
                },
                "user": {
                    "$ref": "#/definitions/models.User"
                }
            }
        },
        "models.ErrorResponse": {
            "type": "object",
            "properties": {
                "error": {
                    "type": "string"
                }
            }
        },
        "models.FeedbackRequest": {
            "type": "object",
            "properties": {
                "query_song_id": {
                    "type": "integer"
                },
                "suggested_song_id": {
                    "type": "integer"
                },
                "vote": {
                    "type": "integer"
                }
            }
        },
        "models.GetSimilarSongsResponse": {
            "type": "object",
            "properties": {
                "count": {
                    "type": "integer"
                },
                "similar_songs": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/models.SimilarSong"
                    }
                }
            }
        },
        "models.GetSongByIDResponse": {
            "type": "object",
            "properties": {
                "song": {
                    "$ref": "#/definitions/models.SongResult"
                }
            }
        },
        "models.ListAllSongsResponse": {
            "type": "object",
            "properties": {
                "count": {
                    "type": "integer"
                },
                "songs": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/models.SongResult"
                    }
                }
            }
        },
        "models.LoginRequest": {
            "type": "object",
            "properties": {
                "password": {
                    "type": "string"
                },
                "username": {
                    "type": "string"
                }
            }
        },
        "models.MessageResponse": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                }
            }
        },
        "models.RegisterRequest": {
            "type": "object",
            "properties": {
                "confirm_password": {
                    "type": "string"
                },
                "email": {
                    "type": "string"
                },
                "password": {
                    "type": "string"
                },
                "user_type": {
                    "type": "string"
                },
                "username": {
                    "type": "string"
                }
            }
        },
        "models.SimilarSong": {
            "type": "object",
            "properties": {
                "artist_name": {
                    "type": "string"
                },
                "id": {
                    "type": "integer"
                },
                "score": {
                    "type": "number"
                },
                "source_platform": {
                    "type": "string"
                },
                "title": {
                    "type": "string"
                },
                "url": {
                    "type": "string"
                }
            }
        },
        "models.SongResult": {
            "type": "object",
            "properties": {
                "added_at": {
                    "type": "string"
                },
                "added_by": {
                    "type": "integer"
                },
                "artist_name": {
                    "type": "string"
                },
                "id": {
                    "type": "integer"
                },
                "source_platform": {
                    "type": "string"
                },
                "title": {
                    "type": "string"
                },
                "url": {
                    "type": "string"
                }
            }
        },
        "models.User": {
            "type": "object",
            "properties": {
                "auth_provider": {
                    "type": "string"
                },
                "avatar_url": {
                    "type": "string"
                },
                "created_at": {
                    "type": "string"
                },
                "email": {
                    "type": "string"
                },
                "google_id": {
                    "type": "string"
                },
                "id": {
                    "type": "integer"
                },
                "updated_at": {
                    "type": "string"
                },
                "user_type": {
                    "type": "string"
                },
                "username": {
                    "type": "string"
                }
            }
        }
    }
}